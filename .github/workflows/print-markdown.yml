name: Render Markdown to PDF

on:
  workflow_dispatch:
    inputs:
      md_file:
        description: 'Markdown file to render'
        required: true
        default: 'README.md'

jobs:
  render-md:
    runs-on: ubuntu-24.04

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Create temporary package.json
        run: |
          mkdir -p .tmp
          cd .tmp
          cp ../scripts/render-md.js .
          echo '{
            "name": "md-printer-temp",
            "version": "1.0.0",
            "private": true,
            "dependencies": {
              "puppeteer": "^24.0.0",
              "marked": "^9.0.0"
            }
          }' > package.json

      - name: Install dependencies
        working-directory: .tmp
        run: npm install

      - name: Render Markdown to PDF
        run: node render-md.js
        working-directory: .tmp
        env:
          MD_PATH: ../${{ github.event.inputs.md_file }}

      - name: Show PDF link in Action summary
        run: |
          PDF_PATH=".tmp/out/rendered.pdf"
          # Extract branch or tag name from GITHUB_REF
          BRANCH_NAME="${GITHUB_REF#refs/heads/}"
          PDF_URL="https://github.com/${GITHUB_REPOSITORY}/raw/${BRANCH_NAME}/${PDF_PATH}"
          echo "Your PDF is ready: [Open PDF in browser](${PDF_URL})" >> $GITHUB_STEP_SUMMARY
        shell: bash
